<svelte:head>
	<title>{blog.title}</title>
</svelte:head>

{#if Boolean($isAuth) && Boolean(blog)}
<div class="w3-container {!$isMobile && 'w3-margin'}">
		<div class="title w3-row">
			<!--
				<div class="w3-bar-item">
						<i class="fas fa-question-circle fa-3x"></i>
				</div>
			-->
			<div class="w3-col m8 s9">
				<h3>
					<a href="/blog" class="w3-text-blue">Blog</a> <i class="fas fa-angle-right w3-text-orange"/> <span class="w3-text-teal">{blog.title}</span>
				</h3>
			</div>
			<div class="w3-col m4 m3 w3-small w3-text-grey">
				<span class="w3-right">
					{blog.timestamp} by <a href="/users/{blog.userId}" class="w3-text-blue">{blog.username}</a>
				</span>
			</div>
		</div>
		<div>
			{@html blog.content}
		</div>
	</div>
{/if}

<style>
	.title {
		display:flex;
    align-items:center;
	}
</style>

<script>
	import * as sapper from '../../../__sapper__/client'

	export default {
		data() {
			return {
				blog: {}
			}
		},
		async oncreate() {
			// this works better than the commented redirect above
			if (Boolean(this.store.get().isAuth) === false) {
				sapper.goto('/')
			}
			// console.log('slug', this, this.get().params)

			try {
				let res = await fetch(`/${this.store.get().CFG.API_VERSION}/blog/${this.get().params.slug}`, {
					method: 'GET',
					credentials: 'same-origin',
					headers: {
						Accept: 'application/json',
						'Content-Type': 'application/json',
					}
				}).then(res => res.json())

				if (res.error) {
					throw res.error
				}
				this.set({ blog: res.blog })

				// this.store.banner({
				// 	html: "Auto dismiss after 3s", 
				// 	level: 'warning',
				// 	duration: 3
				// })
			} catch (err) {
				this.set({ blog: null })
			}
		}
	}
</script>