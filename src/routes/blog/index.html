<svelte:head>
  <title>Blog</title>
</svelte:head>

{#if Boolean($isAuth) }
<div class="w3-container {!$isMobile && 'w3-margin'}">
  <h3 class="w3-text-teal">Blog</h3>

	{#if Boolean(blogs)} 
		{#each blogs as blog}
		<div class="title w3-row">
			<!--
				<div class="w3-bar-item">
						<i class="fas fa-question-circle fa-3x"></i>
				</div>
			-->
			<div class="w3-col m8 s9 w3-large">
				<a href="blog/{blog.slug}">{blog.title}</a>
			</div>
			<div class="w3-col m4 m3 w3-small w3-text-grey">
				<span class="w3-right">
					{blog.timestamp} by <a href="/users/{blog.userId}" class="w3-text-blue">{blog.username}</a>
				</span>
			</div>
		</div>
		<div class="w3-text-grey">
				<a href="blog/{blog.slug}">{@html blog.content}</a>
		</div>
		<hr/>
		{/each} 
	{/if}

</div>
{/if}

<style>
	.title {
		display:flex;
    align-items:center;
	}
</style>

<script>
  import * as sapper from '../../../__sapper__/client'

  export default {
    data() {
      return {
        blogs: [],
      }
    },
    async oncreate() {
      // this works better than the commented redirect above
      if (Boolean(this.store.get().isAuth) === false) {
        sapper.goto('/')
      }

      try {
        let res = await fetch(`/${this.store.get().CFG.API_VERSION}/blog`, {
          method: 'GET',
          credentials: 'same-origin',
          headers: {
            Accept: 'application/json',
            'Content-Type': 'application/json',
          },
        }).then(res => res.json())
        if (res.error) {
          throw res.error
        }
        this.set({ blogs: res.blogs })

        // this.store.banner({
        // 	html: "With a link <a href='/company/about' class='black-text'>About</a> and manual dismiss",
        // 	level: 'info',
        // 	duration: 0
        // })
      } catch (err) {
        this.set({ blogs: [] })
      }
    },
  }
</script>
