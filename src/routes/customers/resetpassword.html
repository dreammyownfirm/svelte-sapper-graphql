<svelte:head>
	<title>{$settings.company} - Reset Password</title>
</svelte:head>

<div class="container">
		<br /> <!-- because title is inside the box -->
		<div class="z-depth-2 row row-top center">
		<h4 class="teal-text">Reset Password</h4>
		<form class="col s12" on:submit="handleSubmit(event)">
			<div class="input-field col s12">
				<input class="validate" type="email" required="true" bind:value="form.email" id="email" />
				<label for="email" class="{form.email ? 'active' : ''}">Email</label>
				<span class="helper-text" data-error="Enter a valid email address"></span>
			</div>

			<div class="row">
				<button type="submit" class="col s12 btn btn-large waves-effect">Reset password</button>
			</div>

			<div class="row">
				An email will be sent to you
			</div>

		</form>

	</div>
</div>

<script>
	export default {
		onupdate({ changed, current, previous }) {
			console.log('resetpassword onupdate', 'changed', changed, 'current', current, 'previous', previous)
		},
		onstate({ changed, current, previous }) {
			console.log('resetpassword onstate', 'changed', changed, 'current', current, 'previous', previous)
		},
		data() {
			return {
				form: {
					email: 'test@test.com'
				}
			}
		},
		methods: {
			handleSubmit(evt) {
				evt.preventDefault()

				let formData = this.get().form
				console.log("resetpassword submit", formData, this.store)

				this.store.resetpassword(formData)
					.then(res => {
						if (res.error) {
							throw res.error
						} else {
							console.log('resetpassword/handleSubmit', res, this.get(), this.store.get())
						}
					})
					.catch(err => {
						console.error('resetpassword/handleSubmit catch', err)
					})
			}
		}
	}
</script>

<style>
	.row-top {
		max-width: 500px;
		padding: 10px;
	}
</style>