<svelte:head>
	<title>{$CFG.BRAND} - Sign Up</title>
</svelte:head>

<div class="container">
	<br /> <!-- because title is inside the box -->
	<div class="z-depth-2 row row-top center">
		<h4 class="teal-text">Sign Up to {$CFG.BRAND}</h4>
		<form class="col s12" on:submit="handleSubmit(event)">
			<div class="row">
				<div class="input-field col s12">
					<input class="validate" type="text" required="true" bind:value="form.username" id="username" />
					<label for="username" class="{form.username ? 'active' : ''}">Name (will be displayed)</label>
					<span class="helper-text" data-error="4 characters minimum"></span>
				</div>

				<div class="input-field col s12">
					<input class="validate" type="email" required="true" bind:value="form.email" id="email" />
					<label for="email" class="{form.email ? 'active' : ''}">Email (will stay private)</label>
					<span class="helper-text" data-error="Enter a valid email address"></span>
				</div>

				<div class="input-field col s12">
					<input class="validate" type="password" required="true" bind:value="form.password" id="password" minlength="8" />
					<label for="password" class="{form.password ? 'active' : ''}">Password</label>
					<span class="helper-text" data-error="8 characters minimum"></span>
				</div>
			</div>

			<div class="row">
				By clicking Sign Up, I agree to {$CFG.BRAND}'s<br />
				<a href="company/tos" target="_tos">Terms of service</a> and <a href="company/privacy" target="_privacy">Privacy
					policy</a>.
			</div>

			<div class="row">
				<button type="submit" class="col s12 btn btn-large waves-effect">Sign Up</button>
			</div>

			<div class="row">
				Already signed up? <a href="/users/login" class="orange-text">Login</a>
			</div>

		</form>
	</div>
</div>


<script>
	import * as sapper from '../../../__sapper__/client'

	export default {
		data() {
			return {
				form: {
					username: 'Test ',
					email: 'test@test.com',
					password: 'test1234'
				}
			}
		},
		methods: {
			async handleSubmit(evt) {
				evt.preventDefault()

				let formData = this.get().form
				// console.log("signup submit", formData, this.store.get())

				if( await this.store.signup(formData)) {
					let {user} = this.store.get()
					// console.log('signup/handleSubmit auth', this.get(), this.store.get())
					this.store.toast({html:`Hello ${user.username}. Thank you for signing up!`})
					sapper.goto('/')
				}
			}
		}
	}
</script>

<style>
	.row-top {
		max-width: 500px;
		padding: 10px;
	}
</style>