<svelte:head>
  <title>{$CFG.BRAND} - Sign Up</title>
</svelte:head>

<div class="w3-container">
  <div class="w3-container w3-padding-24">
    <div class="w3-col l3 m2 s0">&nbsp;</div>
    <div class="w3-col l6 m8 s12 w3-card-4 w3-center">
      <h4 class="w3-margin-top w3-text-teal">Sign Up to {$CFG.BRAND}</h4>

      <form class="w3-container" on:submit="handleSubmit(event)">
        <div class="w3-padding-16">
          <label for="username" class="w3-left {form.username ? 'active' : ''}">Name (will be displayed)</label>
          <input
            class="w3-input w3-border w3-margin-bottom validate"
            type="text"
            required="true"
            bind:value="form.username"
            id="username"
          />
          <span class="helper-text" data-error="4 characters minimum"></span>
          <label for="email" class="w3-left {form.email ? 'active' : ''}">Email (will stay private)</label>
          <input
            class="w3-input w3-border w3-margin-bottom validate"
            type="email"
            required="true"
            bind:value="form.email"
            id="email"
          />
          <span class="helper-text" data-error="Enter a valid email address"></span>
          <label for="password" class="w3-left {form.password ? 'active' : ''}">Password</label>
          <input
            class="w3-input w3-border w3-margin-bottom validate"
            type="password"
            required="true"
            bind:value="form.password"
            id="password"
            minlength="8"
          />
          <span class="helper-text" data-error="8 characters minimum"></span>
        </div>

        <div>
          By clicking Sign Up, I agree to {$CFG.BRAND}'s
          <a href="company/tos" target="_tos" class="w3-text-blue">Terms of service</a> and
          <a href="company/privacy" target="_privacy" class="w3-text-blue">Privacy policy</a>.
        </div>

        <button type="submit" class="w3-button w3-block w3-teal w3-section">Sign Up</button>
      </form>

      <div class="w3-container w3-border-top w3-padding-16 w3-light-grey">
        <span class="w3-center">Already signed up? <a href="/user/login" class="w3-text-orange">Login</a></span>
      </div>
    </div>
    <div class="w3-col l3 m2 s0">&nbsp;</div>
  </div>
</div>

<script>
  import * as sapper from '../../../__sapper__/client'

  export default {
    data() {
      return {
        form: {
          username: 'Test ',
          email: 'test@test.com',
          password: 'test1234',
        },
      }
    },
    methods: {
      async handleSubmit(evt) {
        evt.preventDefault()

        let formData = this.get().form
        // console.log("signup submit", formData, this.store.get())

        if (await this.store.signup(formData)) {
          let { user } = this.store.get()
          // console.log('signup/handleSubmit auth', this.get(), this.store.get())
          this.store.toast({ html: `Hello ${user.username}. Thank you for signing up!` })
          sapper.goto('/')
        }
      },
    },
  }
</script>
